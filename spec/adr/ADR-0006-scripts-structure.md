# ADR 0006: プロジェクト内スクリプト配置方針

## ステータス
**Accepted**

## コンテキスト
現在のプロジェクトルートには以下の開発支援ファイル群が存在する：

- `Makefile`: 開発コマンドの集約（58行、構造化されているが実際は使用していない）
- `start-local.sh`: フルスタック起動スクリプト（便利だが停止処理に課題あり）
- `test.sh`: 全コンポーネントのテスト実行（150行超、複雑だが網羅性があり出力も丁寧で便利）
- `.envrc`: direnv設定 + 開発用alias定義

現状の実態：
- **Makefile**: 整理されているが実際の開発では使用していない
- **test.sh**: 複雑だが網羅性があり、出力も丁寧で便利に使っている
- **start-local.sh**: フル起動に便利だが、実際は個別にターミナルを分けて起動し、それぞれのアクセスログが分かるようにしている
- 停止関連の処理があやしく、手動での管理が必要

現状の課題：
- Makefileが実際の開発フローと乖離している
- start-local.shの停止処理が不完全で、手動管理が必要
- 将来的にDBマイグレーション、データエクスポート等の補助ツールが増える可能性
- 「アプリ共通コード（shared）」と「開発用スクリプト」の責務分離が不明確
- 複数人開発時の保守性・可読性の向上が必要

## 選択肢
1. **Makefile のみで管理**  
   すべてのコマンドを Makefile に書く
2. **package.json の npm scripts のみで管理**  
   JS 開発者には親しみやすいが、Node が前提になる
3. **自作シェルと .envrc の alias で管理**  
   環境依存が強く、保守負荷が高くなる
4. **`/scripts` ディレクトリを作成し、Makefile/npm scripts から呼び出す** ✅

## 決定
- `/scripts` ディレクトリを新設し、開発・運用スクリプトを集約する
  - 主にlocal環境での開発支援を目的とする
  - 小さいものは `scripts/bin/*.sh` に配置（実行権限付き）
  - 複雑なものは `scripts/python/*.py` に配置し、既存のPython環境から実行する
  - 破壊的コマンド（clean/reset）は確認プロンプトを付与
- Makefile を実際の開発フローに合わせて整理し、`/scripts` のスクリプトを呼び出す
  - `make help` で一覧表示・説明を確認できるようにする
  - 実際に使用されるコマンドのみを定義し、実態と乖離しないようにする
- `test.sh` の良い部分（網羅性、丁寧な出力）を維持しつつ、保守性を向上
- `start-local.sh` の停止処理を改善し、個別ターミナル起動のオプションも提供
- `.envrc` は環境変数定義のみに限定
  - `make help`への誘導メッセージのみ表示し、aliasは削除

## 根拠
- Makefileを実際の開発フローに合わせることで、実用性を向上
- `/scripts`に分離することでMakefileが肥大化せず、責務が明確になる
- `test.sh`の良い部分（網羅性、丁寧な出力）を維持しつつ保守性向上
- 個別ターミナル起動など、実際の開発スタイルに対応した柔軟性を提供
- `.envrc`をシンプルに保つことで環境依存トラブルを減らす
- 複数人開発時の可読性・保守性向上

## 工夫
- Makefileは色による識別を行い、利用者にわかりやすいようにする（例：破壊的な実行は赤文字にするなど）
- Makefileのhelpを充実させ、全コマンドの説明を提供する
- `.envrc`では`make help`への誘導メッセージのみ表示し、シンプルに保つ

## 結果
リポジトリ構成例:

```text
/
  Makefile         # 開発コマンドの統一エントリーポイント
  docker-compose.yml
  /frontend
  /backend
  /infra
  /shared          # アプリ共通コード
  /scripts         # 開発・運用用スクリプト（主にlocal環境用）
    bin/
      test.sh      # test.shの分割・整理版
      dev.sh       # start-local.shの後継
    python/
      seed_db.py   # データベース初期化
      migrate.py   # 将来のマイグレーション用
```

## 影響
- 既存の`start-local.sh`の停止処理改善と個別起動オプション追加が必要
- `test.sh`の良い部分を維持しつつ、保守性向上のための整理が必要
- Makefileを実際の開発フローに合わせた見直しが必要
- `.envrc`のalias削除により、開発者は`make help`でコマンドを確認する必要
- 複雑なスクリプトの保守性が向上し、複数人開発に対応可能
