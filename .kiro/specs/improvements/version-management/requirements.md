# バージョン管理ルール化 - 要件書

## はじめに

Janlogアプリケーションのバージョン管理を明確化し、セマンティックバージョニング（Semantic Versioning 2.0.0）に準拠したバージョン管理体系を確立します。フロントエンド、バックエンド、インフラの各サブシステムに対して統一的なバージョン管理ルールを定義し、アプリ内でバージョン情報を表示できるようにします。

## 用語集

- **Janlog**: 麻雀成績記録モバイルアプリケーション
- **セマンティックバージョニング (SemVer)**: `MAJOR.MINOR.PATCH`形式のバージョン管理規約（https://semver.org/）
- **フロントエンド**: Expo React Nativeで実装されたモバイルアプリケーション
- **バックエンド**: FastAPIで実装されたLambda関数
- **インフラストラクチャ**: AWS CDKで実装されたインフラストラクチャコード
- **バージョンエンドポイント**: バージョン情報を返すAPIエンドポイント
- **設定画面**: アプリ内の設定画面

## 要件

### 要件1: セマンティックバージョニング採用

**ユーザーストーリー:** 開発者として、バージョン番号の変更ルールを明確にしたい。そうすることで、リリース時の判断が容易になり、ユーザーへの影響範囲を適切に伝えられる。

#### 受け入れ基準

1. Janlogは、全てのバージョン番号付けにおいてSemantic Versioning 2.0.0仕様を採用すること
2. Janlogは、`MAJOR.MINOR.PATCH`形式のバージョンフォーマットを使用すること。MAJORは破壊的変更、MINORは後方互換性のある機能追加、PATCHは後方互換性のあるバグ修正を示す
3. Janlogは、初期MVPリリースのバージョンを`0.1.0`から開始すること
4. アプリケーションがプレリリース段階（MAJORバージョン0）の間、Janlogは新機能追加時にMINORバージョンを、バグ修正時にPATCHバージョンをインクリメントすること
5. アプリケーションが本番準備完了状態に達した時、Janlogはバージョンを`1.0.0`にインクリメントすること

### 要件2: サブシステムバージョン管理

**ユーザーストーリー:** 開発者として、フロントエンド、バックエンド、インフラの各サブシステムのバージョンを独立して管理したい。そうすることで、各サブシステムの変更を適切に追跡でき、デプロイ時の影響範囲を把握できる。

#### 受け入れ基準

1. フロントエンドは、`package.json`と`app.json`ファイルにバージョンを保持すること
2. バックエンドは、`pyproject.toml`ファイルにバージョンを保持すること
3. インフラストラクチャは、`package.json`ファイルにバージョンを保持すること
4. Janlogは、アプリケーションバージョンをフロントエンドバージョン（ユーザー向けバージョン）として定義すること
5. サブシステムが変更された時、そのサブシステムはセマンティックバージョニングルールに従ってバージョンをインクリメントすること
6. Janlogは、フロントエンド、バックエンド、インフラストラクチャ間のバージョン互換性マトリクスを文書化すること

### 要件3: バージョン情報のAPI提供

**ユーザーストーリー:** フロントエンド開発者として、バックエンドのバージョン情報をAPIで取得したい。そうすることで、フロントエンドとバックエンドの互換性を確認でき、バージョン不一致による問題を早期に検出できる。

#### 受け入れ基準

1. バックエンドは、バージョン情報を返す`/version`エンドポイントを提供すること
2. `/version`エンドポイントは、バックエンドバージョン、APIバージョン、デプロイタイムスタンプを返すこと
3. `/version`エンドポイントは、認証なしでアクセス可能であること
4. `/version`エンドポイントは、ステータスコード200でJSON形式のレスポンスを返すこと
5. バックエンドバージョンが変更された時、`/version`エンドポイントはデプロイ直後に更新されたバージョンを反映すること

### 要件4: アプリ内バージョン表示

**ユーザーストーリー:** ユーザーとして、アプリのバージョン情報を確認したい。そうすることで、サポート問い合わせ時に正確なバージョン情報を伝えられ、最新版を使用しているか確認できる。

#### 受け入れ基準

1. フロントエンドは、設定画面にアプリケーションバージョンを表示すること
2. 設定画面は、フロントエンドバージョン、バックエンドバージョン、ビルド番号を表示すること
3. 設定画面は、`/version`エンドポイントからバックエンドバージョンを取得すること
4. バックエンドに到達できない時、設定画面はバックエンドバージョンとして「不明」を表示すること
5. フロントエンドは、バージョン情報を`v{MAJOR}.{MINOR}.{PATCH}`形式で表示すること（例: `v0.1.0`）

### 要件5: バージョン管理ドキュメント

**ユーザーストーリー:** 開発者として、バージョン管理のルールとプロセスを文書化したい。そうすることで、チーム全体で一貫したバージョン管理が行え、新しいメンバーもルールを理解しやすくなる。

#### 受け入れ基準

1. Janlogは、プロジェクトルートに`VERSIONING.md`ドキュメントを作成すること
2. `VERSIONING.md`は、セマンティックバージョニングのルールと例を文書化すること
3. `VERSIONING.md`は、バージョンインクリメントの判断ツリー（MAJOR、MINOR、PATCHをいつインクリメントするか）を文書化すること
4. `VERSIONING.md`は、サブシステムバージョン管理戦略を文書化すること
5. `VERSIONING.md`は、バージョン互換性マトリクスのフォーマットを文書化すること
6. `VERSIONING.md`は、リリースプロセスとバージョンタグ付け戦略を文書化すること

### 要件6: ビルド番号管理（Android/iOS）

**ユーザーストーリー:** モバイルアプリ開発者として、ストアへの提出時に必要なビルド番号を適切に管理したい。そうすることで、ストアの要件を満たし、バージョン履歴を正確に追跡できる。

#### 受け入れ基準

1. フロントエンドは、`app.json`にAndroidの`versionCode`を保持すること
2. フロントエンドは、`app.json`にiOSの`buildNumber`を保持すること
3. ストア提出用の新しいビルドが作成された時、フロントエンドはビルド番号をインクリメントすること
4. フロントエンドは、ビルド番号に単調増加する整数を使用すること
5. フロントエンドは、セマンティックバージョンとビルド番号の関係を`VERSIONING.md`に文書化すること
