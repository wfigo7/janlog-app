# 実装計画

## MVP段階的開発アプローチ

この実装計画は、最小機能から始めて段階的に機能を追加していくMVPアプローチを採用します。各フェーズで動作するアプリケーションを作成し、ユーザーフィードバックを得ながら次のフェーズに進みます。

## フェーズ1: 基本インフラとシンプルな対局記録

- [x] 1. プロジェクト基盤セットアップ
  - モノレポ構造の作成（frontend、backend、infraディレクトリ）
  - 基本的なpackage.jsonとGitHub Actions設定
  - _要件: 全体的な開発環境_

- [x] 2. バックエンド最小構成の実装
  - FastAPI + LWA の基本セットアップ
  - DynamoDBシングルテーブルの基本構造作成
  - ヘルスチェックエンドポイント（GET /health）の実装
  - _要件: 2.5, 2.6_

- [x] 2.1. ローカル開発環境のDB構築
  - Docker Compose設定ファイルの作成
  - DynamoDB Localコンテナの設定
  - ローカル開発用のテーブル作成スクリプト
  - バックエンドのローカルDB接続設定
  - _要件: 開発環境の整備_

- [x] 3. 認証なしの対局記録API実装
  - 対局データモデル（Match）の実装
  - POST /matches エンドポイント（認証なし、固定ユーザーID使用）
  - GET /matches エンドポイント（認証なし、固定ユーザーID使用）
  - 基本的なバリデーション実装
  - _要件: 2.1, 2.2, 2.5, 2.6_

- [ ] 4. フロントエンド最小構成の実装
  - Expo React Nativeプロジェクトの初期化
  - 基本的なナビゲーション構造（タブナビゲーション）
  - 対局登録画面の基本実装（順位+最終スコアのみ）
  - 対局一覧画面の基本実装
  - _要件: 2.1, 2.2, 3.1_

- [ ] 5. 統計画面の基本実装
  - 統計計算ロジックの実装（対局数、平均順位、トップ率、ラス率）
  - GET /stats/summary エンドポイントの実装
  - 統計画面をトップ画面として実装
  - _要件: 4.1, 4.2, 4.6_

## フェーズ2: 認証とユーザー管理

- [ ] 6. Cognito認証の実装
  - Cognito User Poolの作成とAWS CDK設定
  - JWT Authorizerの設定
  - バックエンドでのJWT検証実装
  - _要件: 1.4, 1.5, 1.6_

- [ ] 7. フロントエンド認証実装
  - ログイン画面の実装
  - Cognitoとの認証連携
  - トークン管理（Secure Storage）
  - _要件: 1.4, 1.5, 1.6_

- [ ] 8. 招待機能の実装
  - Cognito AdminCreateUser APIの実装
  - POST /auth/invite エンドポイント（管理者のみ）
  - 初回パスワード設定フローの実装
  - _要件: 1.1, 1.2, 1.3, 1.7_

## フェーズ3: ゲームモード分離とルール管理

- [ ] 9. ゲームモード分離の実装
  - 3人麻雀・4人麻雀のタブ分離
  - 統計画面でのモード別表示
  - 履歴画面でのモード別表示
  - _要件: 3.2, 3.3, 4.3, 4.4_

- [ ] 10. ルールセット管理の実装
  - Rulesetデータモデルの実装
  - ルールセットCRUD API実装（管理者のみ）
  - デフォルトルールセットの作成
  - _要件: 7.1, 7.2, 7.3, 7.4, 7.5_

- [ ] 11. ルール選択機能の実装
  - 対局登録時のルール選択UI
  - ルール選択に基づく入力フォーム調整
  - _要件: 8.1, 8.2_

## フェーズ4: 複数入力方式とポイント計算

- [ ] 12. 素点入力方式の実装
  - 順位+素点入力UI
  - ウマ・オカを使用したポイント計算ロジック
  - 計算結果確認UI
  - _要件: 6.2, 8.3, 8.4, 8.5_

- [ ] 13. 仮スコア入力方式の実装
  - 順位のみ入力UI
  - ルールに基づく仮スコア計算
  - _要件: 6.3_

- [ ] 14. 入力方式選択機能
  - 入力方式選択UI
  - 方式に応じた動的フォーム表示
  - _要件: 6.1, 6.4_

## フェーズ5: データ管理と拡張機能

- [ ] 15. 対局データ編集・削除機能
  - 対局編集画面の実装
  - PUT /matches/{matchId} エンドポイント
  - DELETE /matches/{matchId} エンドポイント
  - 削除確認ダイアログ
  - _要件: 5.1, 5.2, 5.3, 5.4_

- [ ] 16. 会場・メモ機能の実装
  - 会場ID入力フィールド
  - メモ入力フィールド
  - 対局詳細表示での会場・メモ表示
  - _要件: 9.1, 9.2, 9.3, 9.4_

- [ ] 17. 期間フィルター機能
  - 日付範囲選択UI
  - 統計・履歴での期間フィルタリング
  - _要件: 3.4, 4.5_

## フェーズ6: 最適化とテスト

- [ ] 18. テスト実装
  - バックエンド単体テスト（pytest）
  - フロントエンド単体テスト（Jest）
  - 基本的な統合テスト
  - _テスト戦略に基づく_

- [ ] 19. パフォーマンス最適化
  - DynamoDB GSI最適化
  - フロントエンドキャッシュ実装
  - Lambda最適化
  - _パフォーマンス最適化に基づく_

- [ ] 20. デプロイメント自動化
  - AWS CDKによるインフラ自動化
  - GitHub Actionsによる CI/CD
  - 本番環境デプロイ
  - _CI/CD戦略に基づく_

## 各フェーズの完了基準

- **フェーズ1**: ローカル開発環境で認証なしの対局記録・一覧表示・基本統計が動作する
- **フェーズ2**: 招待制認証でユーザー管理ができる
- **フェーズ3**: 3人麻雀・4人麻雀が分離され、ルール管理ができる
- **フェーズ4**: 3つの入力方式すべてが使用できる
- **フェーズ5**: データ編集・削除、会場・メモ管理ができる
- **フェーズ6**: 本番環境で安定稼働する

## 注意事項

- 各フェーズ完了時に動作確認を行い、問題があれば次のフェーズに進まない
- ユーザーフィードバックを各フェーズで収集し、必要に応じて計画を調整する
- 最小限の機能で各フェーズを完了させ、過度な実装は避ける